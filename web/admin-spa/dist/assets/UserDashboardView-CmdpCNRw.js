import{r as T,_ as J,o as Q,x as r,L as h,y as l,z as e,Y as X,K as H,aq as W,P as a,O as j,C as z,u as y,c as L,q as E,R as F,Q as R,ac as N,aV as Z,V as ee,aW as te,B as se,D as oe,aU as ae}from"./vue-vendor-DfX6Lnp2.js";import{b as q,s as D,f as A,c as S,a as G}from"./index-DuV9RUIJ.js";import{T as re}from"./ThemeToggle-CQuf1b0L.js";import{C as le}from"./ConfirmModal-CnVMxx94.js";import{C as Y}from"./chart-yFHxLHpB.js";import{T as de}from"./TutorialView-Bjz5QcGl.js";import"./element-plus-AVrsaVJp.js";import"./vendor-Dr8jvgFu.js";const ne={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-600 bg-opacity-50"},ie={class:"relative top-20 mx-auto w-[768px] max-w-4xl rounded-md border bg-white p-5 shadow-lg"},ue={class:"mt-3"},ce={class:"mb-4 flex items-center justify-between"},xe=["disabled"],me=["disabled"],ge={key:0,class:"rounded-md border border-red-200 bg-red-50 p-3"},ye={class:"flex"},ve={class:"ml-3"},pe={class:"text-sm text-red-700"},fe={class:"flex justify-end space-x-3 pt-4"},ke=["disabled"],he=["disabled"],be={key:0,class:"flex items-center"},we={key:1},_e={key:0,class:"mt-6 rounded-md border border-green-200 bg-green-50 p-4"},$e={class:"flex items-start"},Ce={class:"ml-3 flex-1"},Ae={class:"mt-3"},Me={class:"rounded-md border border-green-300 bg-white p-3"},Te={class:"flex items-center justify-between"},Ie={class:"break-all font-mono text-sm text-gray-900"},Pe={__name:"CreateApiKeyModal",props:{show:{type:Boolean,default:!1}},emits:["close","created"],setup(c,{emit:B}){const I=c,$=B,g=q(),u=T(!1),s=T(""),k=T(null),b=J({name:"",description:""}),M=()=>{b.name="",b.description="",s.value="",k.value=null},U=async()=>{var f,d;if(!b.name.trim()){s.value="API key name is required";return}u.value=!0,s.value="";try{const v={name:b.name.trim(),description:b.description.trim()||void 0},p=await g.createApiKey(v);p.success?(k.value=p.apiKey,D("API key created successfully!","success")):s.value=p.message||"Failed to create API key"}catch(v){console.error("Create API key error:",v),s.value=((d=(f=v.response)==null?void 0:f.data)==null?void 0:d.message)||v.message||"Failed to create API key"}finally{u.value=!1}},w=async f=>{try{await navigator.clipboard.writeText(f),D("API key copied to clipboard!","success")}catch(d){console.error("Failed to copy:",d),D("Failed to copy to clipboard","error")}},o=()=>{M(),$("created"),$("close")};return Q(()=>I.show,f=>{f&&M()}),(f,d)=>c.show?(l(),r("div",ne,[e("div",ie,[e("div",ue,[e("div",ce,[d[6]||(d[6]=e("h3",{class:"text-lg font-medium text-gray-900"},"Create New API Key",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:d[0]||(d[0]=v=>f.$emit("close"))},d[5]||(d[5]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("form",{class:"space-y-4",onSubmit:X(U,["prevent"])},[e("div",null,[d[7]||(d[7]=e("label",{class:"block text-sm font-medium text-gray-700",for:"name"}," Name * ",-1)),H(e("input",{id:"name","onUpdate:modelValue":d[1]||(d[1]=v=>b.name=v),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",disabled:u.value,placeholder:"Enter API key name",required:"",type:"text"},null,8,xe),[[W,b.name]])]),e("div",null,[d[8]||(d[8]=e("label",{class:"block text-sm font-medium text-gray-700",for:"description"}," Description ",-1)),H(e("textarea",{id:"description","onUpdate:modelValue":d[2]||(d[2]=v=>b.description=v),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",disabled:u.value,placeholder:"Optional description",rows:"3"},null,8,me),[[W,b.description]])]),s.value?(l(),r("div",ge,[e("div",ye,[d[9]||(d[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"clip-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","fill-rule":"evenodd"})])],-1)),e("div",ve,[e("p",pe,a(s.value),1)])])])):h("",!0),e("div",fe,[e("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",disabled:u.value,type:"button",onClick:d[3]||(d[3]=v=>f.$emit("close"))}," Cancel ",8,ke),e("button",{class:"rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value||!b.name.trim(),type:"submit"},[u.value?(l(),r("span",be,d[10]||(d[10]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4 animate-spin text-white",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),j(" Creating... ",-1)]))):(l(),r("span",we,"Create API Key"))],8,he)])],32),k.value?(l(),r("div",_e,[e("div",$e,[d[14]||(d[14]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"clip-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","fill-rule":"evenodd"})])],-1)),e("div",Ce,[d[13]||(d[13]=e("h4",{class:"text-sm font-medium text-green-800"},"API Key Created Successfully!",-1)),e("div",Ae,[d[12]||(d[12]=e("p",{class:"mb-2 text-sm text-green-700"},[e("strong",null,"Important:"),j(" Copy your API key now. You won't be able to see it again! ")],-1)),e("div",Me,[e("div",Te,[e("code",Ie,a(k.value.key),1),e("button",{class:"ml-3 inline-flex flex-shrink-0 items-center rounded border border-transparent bg-green-100 px-2 py-1 text-xs font-medium text-green-700 hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:d[4]||(d[4]=v=>w(k.value.key))},d[11]||(d[11]=[e("svg",{class:"mr-1 h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),j(" Copy ",-1)]))])])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{class:"rounded-md border border-transparent bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:o}," Done ")])])])])):h("",!0)])])])):h("",!0)}},Ue={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-600 bg-opacity-50"},Be={class:"relative top-20 mx-auto w-[768px] max-w-4xl rounded-md border bg-white p-5 shadow-lg"},De={class:"mt-3"},Se={class:"mb-4 flex items-center justify-between"},je={key:0,class:"space-y-4"},Ke={class:"mt-1 text-sm text-gray-900"},ze={key:0},Fe={class:"mt-1 text-sm text-gray-900"},Ve={class:"mt-1 flex items-center space-x-2"},Le={class:"flex-1"},qe={key:0,class:"rounded-md border border-gray-300 bg-gray-50 p-3"},He={class:"break-all font-mono text-sm text-gray-900"},Re={key:1,class:"rounded-md border border-gray-300 bg-gray-50 p-3"},Ne={class:"font-mono text-sm text-gray-900"},Ee={class:"flex flex-col space-y-1"},Oe={key:0,class:"mr-1 h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},We={key:1,class:"mr-1 h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ye={key:0,class:"mt-1 text-xs text-gray-500"},Qe={class:"mt-1"},Ge={key:1,class:"border-t border-gray-200 pt-4"},Je={class:"grid grid-cols-2 gap-4 text-sm"},Xe={class:"ml-2 font-medium"},Ze={class:"ml-2 font-medium"},et={class:"ml-2 font-medium"},tt={class:"ml-2 font-medium"},st={class:"space-y-2 border-t border-gray-200 pt-4 text-sm"},ot={class:"flex justify-between"},at={class:"text-gray-900"},rt={key:0,class:"flex justify-between"},lt={class:"text-gray-900"},dt={key:1,class:"flex justify-between"},nt={class:"flex justify-end pt-4"},it={__name:"ViewApiKeyModal",props:{show:{type:Boolean,default:!1},apiKey:{type:Object,default:null}},emits:["close"],setup(c,{emit:B}){const I=B,$=T(!1),g=async u=>{try{await navigator.clipboard.writeText(u),D("Copied to clipboard!","success")}catch(s){console.error("Failed to copy:",s),D("Failed to copy to clipboard","error")}};return(u,s)=>c.show?(l(),r("div",Ue,[e("div",Be,[e("div",De,[e("div",Se,[s[5]||(s[5]=e("h3",{class:"text-lg font-medium text-gray-900"},"API Key Details",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:s[0]||(s[0]=k=>I("close"))},s[4]||(s[4]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),c.apiKey?(l(),r("div",je,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Name",-1)),e("p",Ke,a(c.apiKey.name),1)]),c.apiKey.description?(l(),r("div",ze,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),e("p",Fe,a(c.apiKey.description),1)])):h("",!0),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"API Key",-1)),e("div",Ve,[e("div",Le,[$.value?(l(),r("div",qe,[e("code",He,a(c.apiKey.key||"Not available"),1)])):(l(),r("div",Re,[e("code",Ne,a(c.apiKey.keyPreview||"cr_****"),1)]))]),e("div",Ee,[c.apiKey.key?(l(),r("button",{key:0,class:"inline-flex items-center rounded border border-gray-300 bg-white px-2 py-1 text-xs font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:s[1]||(s[1]=k=>$.value=!$.value)},[$.value?(l(),r("svg",Oe,s[8]||(s[8]=[e("path",{d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L12 12m-1.122-2.122L12 12m-1.122-2.122l-4.243-4.242m6.879 6.878L15 15","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},null,-1)]))):(l(),r("svg",We,s[9]||(s[9]=[e("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},null,-1),e("path",{d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},null,-1)]))),j(" "+a($.value?"Hide":"Show"),1)])):h("",!0),$.value&&c.apiKey.key?(l(),r("button",{key:1,class:"inline-flex items-center rounded border border-gray-300 bg-white px-2 py-1 text-xs font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:s[2]||(s[2]=k=>g(c.apiKey.key))},s[10]||(s[10]=[e("svg",{class:"mr-1 h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),j(" Copy ",-1)]))):h("",!0)])]),c.apiKey.key?h("",!0):(l(),r("p",Ye," Full API key is only shown when first created or regenerated "))]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1)),e("div",Qe,[e("span",{class:z(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",c.apiKey.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},a(c.apiKey.isActive?"Active":"Disabled"),3)])]),c.apiKey.usage?(l(),r("div",Ge,[s[17]||(s[17]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700"},"Usage Statistics",-1)),e("div",Je,[e("div",null,[s[13]||(s[13]=e("span",{class:"text-gray-500"},"Requests:",-1)),e("span",Xe,a(y(A)(c.apiKey.usage.requests||0)),1)]),e("div",null,[s[14]||(s[14]=e("span",{class:"text-gray-500"},"Input Tokens:",-1)),e("span",Ze,a(y(A)(c.apiKey.usage.inputTokens||0)),1)]),e("div",null,[s[15]||(s[15]=e("span",{class:"text-gray-500"},"Output Tokens:",-1)),e("span",et,a(y(A)(c.apiKey.usage.outputTokens||0)),1)]),e("div",null,[s[16]||(s[16]=e("span",{class:"text-gray-500"},"Total Cost:",-1)),e("span",tt,"$"+a((c.apiKey.usage.totalCost||0).toFixed(4)),1)])])])):h("",!0),e("div",st,[e("div",ot,[s[18]||(s[18]=e("span",{class:"text-gray-500"},"Created:",-1)),e("span",at,a(y(S)(c.apiKey.createdAt)),1)]),c.apiKey.lastUsedAt?(l(),r("div",rt,[s[19]||(s[19]=e("span",{class:"text-gray-500"},"Last Used:",-1)),e("span",lt,a(y(S)(c.apiKey.lastUsedAt)),1)])):h("",!0),c.apiKey.expiresAt?(l(),r("div",dt,[s[20]||(s[20]=e("span",{class:"text-gray-500"},"Expires:",-1)),e("span",{class:z(["font-medium",new Date(c.apiKey.expiresAt)<new Date?"text-red-600":"text-gray-900"])},a(y(S)(c.apiKey.expiresAt)),3)])):h("",!0)]),e("div",nt,[e("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:s[3]||(s[3]=k=>I("close"))}," Close ")])])):h("",!0)])])])):h("",!0)}},ut={class:"space-y-6"},ct={class:"sm:flex sm:items-center"},xt={class:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none"},mt=["disabled"],gt={key:0,class:"rounded-md border border-yellow-200 bg-yellow-50 p-4"},yt={class:"flex"},vt={class:"ml-3"},pt={class:"text-sm text-yellow-700 dark:text-yellow-600"},ft={key:1,class:"py-12 text-center"},kt={key:2,class:"overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md"},ht={class:"divide-y divide-gray-200 dark:divide-gray-700",role:"list"},bt={class:"flex items-center justify-between"},wt={class:"flex items-center"},_t={class:"flex-shrink-0"},$t={class:"ml-4"},Ct={class:"flex items-center"},At={class:"text-sm font-medium text-gray-900 dark:text-white"},Mt={key:0,class:"ml-2 inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800 dark:bg-gray-700 dark:text-gray-300"},Tt={key:1,class:"ml-2 inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800 dark:bg-red-900 dark:text-red-200"},It={class:"mt-1"},Pt={class:"text-sm text-gray-500 dark:text-gray-400"},Ut={class:"mt-1 flex items-center space-x-4 text-xs text-gray-400 dark:text-gray-500"},Bt={key:0},Dt={key:1},St={key:2},jt={key:3},Kt={class:"flex items-center space-x-2"},zt={class:"text-right text-xs text-gray-500 dark:text-gray-400"},Ft={key:0},Vt={class:"flex items-center space-x-1"},Lt=["onClick"],qt=["onClick"],Ht={key:3,class:"py-12 text-center"},Rt={class:"mt-6"},Nt={__name:"UserApiKeysManager",setup(c){const B=q(),I=T(!0),$=T([]),g=L(()=>{var x;return((x=B.config)==null?void 0:x.maxApiKeysPerUser)||5}),u=L(()=>{var x;return((x=B.config)==null?void 0:x.allowUserDeleteApiKeys)===!0}),s=T(!1),k=T(!1),b=T(!1),M=T(null),U=L(()=>[...$.value].sort((x,n)=>{const m=new Date(x.createdAt);return new Date(n.createdAt)-m})),w=L(()=>$.value.filter(x=>!(x.isDeleted==="true"||x.deletedAt)).length),o=async()=>{I.value=!0;try{$.value=await B.getUserApiKeys(!0)}catch(x){console.error("Failed to load API keys:",x),D("Failed to load API keys","error")}finally{I.value=!1}},f=x=>{M.value=x,k.value=!0},d=x=>{M.value=x,b.value=!0},v=async()=>{try{(await B.deleteApiKey(M.value.id)).success&&(D("API key deleted successfully","success"),await o())}catch(x){console.error("Failed to delete API key:",x),D("Failed to delete API key","error")}finally{b.value=!1,M.value=null}},p=async()=>{s.value=!1,await o()};return E(()=>{o()}),(x,n)=>{var m;return l(),r("div",ut,[e("div",ct,[n[6]||(n[6]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"我的 API 密钥"),e("p",{class:"mt-2 text-sm text-gray-700 dark:text-gray-400"}," 管理您的 API 密钥以访问 Claude Relay 服务 ")],-1)),e("div",xt,[e("button",{class:"inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 sm:w-auto",disabled:w.value>=g.value,onClick:n[0]||(n[0]=t=>s.value=!0)},n[5]||(n[5]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 6v6m0 0v6m0-6h6m-6 0H6","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),j(" 创建 API 密钥 ",-1)]),8,mt)])]),w.value>=g.value?(l(),r("div",gt,[e("div",yt,[n[7]||(n[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"clip-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","fill-rule":"evenodd"})])],-1)),e("div",vt,[e("p",pt," 您已达到 API 密钥的最大数量限制（"+a(g.value)+"）。请删除现有密钥以创建新密钥。 ",1)])])])):h("",!0),I.value?(l(),r("div",ft,n[8]||(n[8]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"加载 API 密钥中...",-1)]))):U.value.length>0?(l(),r("div",kt,[e("ul",ht,[(l(!0),r(R,null,N(U.value,t=>{var i,C;return l(),r("li",{key:t.id,class:"px-6 py-4"},[e("div",bt,[e("div",wt,[e("div",_t,[e("div",{class:z(["h-2 w-2 rounded-full",t.isDeleted===!0||t.deletedAt?"bg-gray-400":t.isActive?"bg-green-400":"bg-red-400"])},null,2)]),e("div",$t,[e("div",Ct,[e("p",At,a(t.name),1),t.isDeleted===!0||t.deletedAt?(l(),r("span",Mt," 已删除 ")):t.isActive?h("",!0):(l(),r("span",Tt," 已删除 "))]),e("div",It,[e("p",Pt,a(t.description||"无描述"),1),e("div",Ut,[e("span",null,"创建时间："+a(y(S)(t.createdAt)),1),t.isDeleted==="true"||t.deletedAt?(l(),r("span",Bt,"删除时间："+a(y(S)(t.deletedAt)),1)):t.lastUsedAt?(l(),r("span",Dt,"最后使用："+a(y(S)(t.lastUsedAt)),1)):(l(),r("span",St,"从未使用")),t.expiresAt&&!(t.isDeleted==="true"||t.deletedAt)?(l(),r("span",jt,"过期时间："+a(y(S)(t.expiresAt)),1)):h("",!0)])])])]),e("div",Kt,[e("div",zt,[e("div",null,a(y(A)(((i=t.usage)==null?void 0:i.requests)||0))+" 次请求",1),(C=t.usage)!=null&&C.totalCost?(l(),r("div",Ft,"$"+a(t.usage.totalCost.toFixed(4)),1)):h("",!0)]),e("div",Vt,[e("button",{class:"inline-flex items-center rounded border border-transparent p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"查看 API 密钥",onClick:P=>f(t)},n[9]||(n[9]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"}),e("path",{d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Lt),!(t.isDeleted==="true"||t.deletedAt)&&t.isActive&&u.value?(l(),r("button",{key:0,class:"inline-flex items-center rounded border border-transparent p-1 text-red-400 hover:text-red-600 dark:text-red-500 dark:hover:text-red-400",title:"删除 API 密钥",onClick:P=>d(t)},n[10]||(n[10]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,qt)):h("",!0)])])])])}),128))])])):(l(),r("div",Ht,[n[12]||(n[12]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15 7a2 2 0 012 2m0 0a2 2 0 012 2m-2-2h-6m6 0v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2h6z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)),n[13]||(n[13]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"暂无 API 密钥",-1)),n[14]||(n[14]=e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"开始创建您的第一个 API 密钥。",-1)),e("div",Rt,[e("button",{class:"inline-flex items-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:n[1]||(n[1]=t=>s.value=!0)},n[11]||(n[11]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 6v6m0 0v6m0-6h6m-6 0H6","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),j(" 创建 API 密钥 ",-1)]))])])),F(Pe,{show:s.value,onClose:n[2]||(n[2]=t=>s.value=!1),onCreated:p},null,8,["show"]),F(it,{"api-key":M.value,show:k.value,onClose:n[3]||(n[3]=t=>k.value=!1)},null,8,["api-key","show"]),F(le,{"confirm-class":"bg-red-600 hover:bg-red-700","confirm-text":"删除",message:`确定要删除 '${(m=M.value)==null?void 0:m.name}' 吗？此操作无法撤销。`,show:b.value,title:"删除 API 密钥",onCancel:n[4]||(n[4]=t=>b.value=!1),onConfirm:v},null,8,["message","show"])])}}},Et={class:"space-y-6"},Ot={class:"sm:flex sm:items-center"},Wt={class:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none"},Yt={key:0,class:"py-12 text-center"},Qt={key:1,class:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4"},Gt={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},Jt={class:"p-5"},Xt={class:"flex items-center"},Zt={class:"ml-5 w-0 flex-1"},es={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ts={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},ss={class:"p-5"},os={class:"flex items-center"},as={class:"ml-5 w-0 flex-1"},rs={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ls={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},ds={class:"p-5"},ns={class:"flex items-center"},is={class:"ml-5 w-0 flex-1"},us={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},cs={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},xs={class:"p-5"},ms={class:"flex items-center"},gs={class:"ml-5 w-0 flex-1"},ys={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},vs={key:2,class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},ps={class:"rounded-lg bg-white shadow dark:bg-gray-800"},fs={class:"px-4 py-5 sm:p-6"},ks={class:"relative",style:{height:"300px"}},hs={class:"rounded-lg bg-white shadow dark:bg-gray-800"},bs={class:"px-4 py-5 sm:p-6"},ws={class:"max-h-[300px] space-y-3 overflow-auto"},_s={class:"flex items-center"},$s={class:"flex-shrink-0"},Cs={class:"ml-3"},As={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ms={class:"text-xs text-gray-500 dark:text-gray-400"},Ts={class:"text-right"},Is={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ps={class:"text-xs text-gray-500 dark:text-gray-400"},Us={key:3,class:"rounded-lg bg-white shadow dark:bg-gray-800"},Bs={class:"px-4 py-5 sm:p-6"},Ds={class:"relative",style:{height:"350px"}},Ss={key:4,class:"rounded-lg bg-white shadow dark:bg-gray-800"},js={class:"px-4 py-5 sm:p-6"},Ks={class:"overflow-x-auto"},zs={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Fs={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Vs={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100"},Ls={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100"},qs={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100"},Hs={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100"},Rs={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100"},Ns={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100"},Es={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100"},Os={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100"},Ws={key:5,class:"rounded-lg bg-white py-12 text-center shadow dark:bg-gray-800"},Ys={__name:"UserUsageStats",setup(c){const B=q(),I=G(),{isDarkMode:$}=Z(I),g=T(!0),u=T("week"),s=T(null),k=T(null),b=T(null);let M=null,U=null;const w=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#6366F1","#84CC16"],o=L(()=>({text:$.value?"#e5e7eb":"#374151",grid:$.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)",legend:$.value?"#e5e7eb":"#374151"})),f=m=>{var i;const t=(((i=s.value)==null?void 0:i.modelStats)||[]).findIndex(C=>C.name===m);return w[t%w.length]},d=m=>{var i;const t=(((i=s.value)==null?void 0:i.modelStats)||[]).reduce((C,P)=>C+(P.totalTokens||0),0);return t===0?0:(m.totalTokens/t*100).toFixed(1)},v=L(()=>{var m;return(m=s.value)!=null&&m.dailyStats?[...s.value.dailyStats].sort((t,i)=>new Date(i.date)-new Date(t.date)):[]}),p=()=>{var t;if(!k.value||!((t=s.value)!=null&&t.modelStats))return;M&&M.destroy();const m=s.value.modelStats;M=new Y(k.value,{type:"doughnut",data:{labels:m.map(i=>i.name),datasets:[{data:m.map(i=>i.totalTokens||0),backgroundColor:w,borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:15,usePointStyle:!0,font:{size:12},color:o.value.legend}},tooltip:{callbacks:{label:function(i){const C=i.label||"",P=A(i.parsed),K=d(m[i.dataIndex]);return`${C}: ${P} (${K}%)`}}}}}})},x=()=>{var t;if(!b.value||!((t=s.value)!=null&&t.dailyStats))return;U&&U.destroy();const m=s.value.dailyStats;U=new Y(b.value,{type:"line",data:{labels:m.map(i=>i.date),datasets:[{label:"请求数",data:m.map(i=>i.requests||0),borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.3,yAxisID:"y1"},{label:"Token 总量",data:m.map(i=>(i.inputTokens||0)+(i.outputTokens||0)),borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.3},{label:"费用 (USD)",data:m.map(i=>i.cost||0),borderColor:"#F59E0B",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.3,yAxisID:"y2"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top",labels:{color:o.value.legend}},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(i){const C=i.dataset.label||"";let P=i.parsed.y;return C==="费用 (USD)"?`${C}: $${P.toFixed(4)}`:C==="请求数"?`${C}: ${P.toLocaleString()} 次`:`${C}: ${A(P)}`}}}},scales:{x:{ticks:{color:o.value.text},grid:{color:o.value.grid}},y:{type:"linear",position:"left",min:0,title:{display:!0,text:"Token 数量",color:o.value.text},ticks:{callback:i=>A(i),color:o.value.text},grid:{color:o.value.grid}},y1:{type:"linear",position:"right",min:0,title:{display:!0,text:"请求数",color:o.value.text},grid:{drawOnChartArea:!1},ticks:{callback:i=>i.toLocaleString(),color:o.value.text}},y2:{type:"linear",display:!1,position:"right",min:0}}}})},n=async()=>{g.value=!0;try{const m=await B.getUserUsageStats({period:u.value});s.value=m,g.value=!1,await oe(),p(),x()}catch(m){console.error("Failed to load usage stats:",m),D("加载使用统计失败","error"),g.value=!1}};return Q($,()=>{p(),x()}),ee(()=>{M&&M.destroy(),U&&U.destroy()}),E(()=>{n()}),(m,t)=>{var i,C,P,K,V,O;return l(),r("div",Et,[e("div",Ot,[t[2]||(t[2]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-gray-100"},"使用统计"),e("p",{class:"mt-2 text-sm text-gray-700 dark:text-gray-300"},"查看您的 API 使用统计和成本")],-1)),e("div",Wt,[H(e("select",{"onUpdate:modelValue":t[0]||(t[0]=_=>u.value=_),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 sm:text-sm",onChange:n},t[1]||(t[1]=[e("option",{value:"day"},"最近 24 小时",-1),e("option",{value:"week"},"最近 7 天",-1),e("option",{value:"month"},"最近 30 天",-1)]),544),[[te,u.value]])])]),g.value?(l(),r("div",Yt,t[3]||(t[3]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"正在加载使用统计...",-1)]))):(l(),r("div",Qt,[e("div",Gt,[e("div",Jt,[e("div",Xt,[t[5]||(t[5]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M13 10V3L4 14h7v7l9-11h-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Zt,[e("dl",null,[t[4]||(t[4]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总请求数 ",-1)),e("dd",es,a(y(A)(((i=s.value)==null?void 0:i.totalRequests)||0)),1)])])])])]),e("div",ts,[e("div",ss,[e("div",os,[t[7]||(t[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",as,[e("dl",null,[t[6]||(t[6]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 输入 Tokens ",-1)),e("dd",rs,a(y(A)(((C=s.value)==null?void 0:C.totalInputTokens)||0)),1)])])])])]),e("div",ls,[e("div",ds,[e("div",ns,[t[9]||(t[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",is,[e("dl",null,[t[8]||(t[8]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 输出 Tokens ",-1)),e("dd",us,a(y(A)(((P=s.value)==null?void 0:P.totalOutputTokens)||0)),1)])])])])]),e("div",cs,[e("div",xs,[e("div",ms,[t[11]||(t[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",gs,[e("dl",null,[t[10]||(t[10]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总成本 ",-1)),e("dd",ys," $"+a((((K=s.value)==null?void 0:K.totalCost)||0).toFixed(4)),1)])])])])])])),!g.value&&s.value&&((V=s.value.modelStats)==null?void 0:V.length)>0?(l(),r("div",vs,[e("div",ps,[e("div",fs,[t[12]||(t[12]=e("h3",{class:"mb-4 text-lg font-medium leading-6 text-gray-900 dark:text-gray-100"}," Token 使用分布 ",-1)),e("div",ks,[e("canvas",{ref_key:"modelUsageChart",ref:k},null,512)])])]),e("div",hs,[e("div",bs,[t[13]||(t[13]=e("h3",{class:"mb-4 text-lg font-medium leading-6 text-gray-900 dark:text-gray-100"}," 模型使用详情 ",-1)),e("div",ws,[(l(!0),r(R,null,N(s.value.modelStats,_=>(l(),r("div",{key:_.name,class:"flex items-center justify-between rounded-lg border border-gray-200 p-3 dark:border-gray-700"},[e("div",_s,[e("div",$s,[e("div",{class:"h-3 w-3 rounded-full",style:se({backgroundColor:f(_.name)})},null,4)]),e("div",Cs,[e("p",As,a(_.name),1),e("p",Ms,a(d(_))+"% ",1)])]),e("div",Ts,[e("p",Is,a(y(A)(_.requests))+" 请求 ",1),e("p",Ps,"$"+a(_.cost.toFixed(4)),1)])]))),128))])])])])):h("",!0),!g.value&&s.value&&((O=s.value.dailyStats)==null?void 0:O.length)>0?(l(),r("div",Us,[e("div",Bs,[t[14]||(t[14]=e("h3",{class:"mb-4 text-lg font-medium leading-6 text-gray-900 dark:text-gray-100"}," 使用趋势 ",-1)),e("div",Ds,[e("canvas",{ref_key:"usageTrendChart",ref:b},null,512)])])])):h("",!0),!g.value&&v.value.length>0?(l(),r("div",Ss,[e("div",js,[t[16]||(t[16]=e("h3",{class:"mb-4 text-lg font-medium leading-6 text-gray-900 dark:text-gray-100"}," 使用明细 ",-1)),e("div",Ks,[e("table",zs,[t[15]||(t[15]=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 日期 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 请求数 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 输入 Tokens "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 输出 Tokens "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 缓存创建 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 缓存读取 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," Token 总量 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 成本 ")])],-1)),e("tbody",Fs,[(l(!0),r(R,null,N(v.value,_=>(l(),r("tr",{key:_.date,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Vs,a(_.date),1),e("td",Ls,a(y(A)(_.requests||0)),1),e("td",qs,a(y(A)(_.inputTokens||0)),1),e("td",Hs,a(y(A)(_.outputTokens||0)),1),e("td",Rs,a(y(A)(_.cacheCreateTokens||0)),1),e("td",Ns,a(y(A)(_.cacheReadTokens||0)),1),e("td",Es,a(y(A)((_.inputTokens||0)+(_.outputTokens||0)+(_.cacheCreateTokens||0)+(_.cacheReadTokens||0))),1),e("td",Os," $"+a((_.cost||0).toFixed(4)),1)]))),128))])])])])])):h("",!0),!g.value&&(!s.value||s.value.totalRequests===0)?(l(),r("div",Ws,t[17]||(t[17]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100"},"无使用数据",-1),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," 您还没有发起任何 API 请求。创建 API 密钥并开始使用服务以查看使用统计。 ",-1)]))):h("",!0)])}}},Qs={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},Gs={class:"bg-white shadow dark:bg-gray-800"},Js={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},Xs={class:"flex h-16 justify-between"},Zs={class:"flex items-center"},eo={class:"ml-10"},to={class:"flex items-baseline space-x-4"},so={class:"flex items-center space-x-4"},oo={class:"text-sm text-gray-700 dark:text-gray-300"},ao={class:"font-medium"},ro={class:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8"},lo={key:0,class:"space-y-6"},no={class:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-5"},io={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},uo={class:"p-5"},co={class:"flex items-center"},xo={class:"ml-5 w-0 flex-1"},mo={class:"text-lg font-medium text-gray-900 dark:text-white"},go={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},yo={class:"p-5"},vo={class:"flex items-center"},po={class:"ml-5 w-0 flex-1"},fo={class:"text-lg font-medium text-gray-900 dark:text-white"},ko={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},ho={class:"p-5"},bo={class:"flex items-center"},wo={class:"ml-5 w-0 flex-1"},_o={class:"text-lg font-medium text-gray-900 dark:text-white"},$o={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},Co={class:"p-5"},Ao={class:"flex items-center"},Mo={class:"ml-5 w-0 flex-1"},To={class:"text-lg font-medium text-gray-900 dark:text-white"},Io={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},Po={class:"p-5"},Uo={class:"flex items-center"},Bo={class:"ml-5 w-0 flex-1"},Do={class:"text-lg font-medium text-gray-900 dark:text-white"},So={class:"rounded-lg bg-white shadow dark:bg-gray-800"},jo={class:"px-4 py-5 sm:p-6"},Ko={class:"mt-5 border-t border-gray-200 dark:border-gray-700"},zo={class:"divide-y divide-gray-200 dark:divide-gray-700"},Fo={class:"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5"},Vo={class:"mt-1 text-sm text-gray-900 dark:text-white sm:col-span-2 sm:mt-0"},Lo={class:"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5"},qo={class:"mt-1 text-sm text-gray-900 dark:text-white sm:col-span-2 sm:mt-0"},Ho={class:"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5"},Ro={class:"mt-1 text-sm text-gray-900 dark:text-white sm:col-span-2 sm:mt-0"},No={class:"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5"},Eo={class:"mt-1 text-sm text-gray-900 dark:text-white sm:col-span-2 sm:mt-0"},Oo={class:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200"},Wo={class:"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5"},Yo={class:"mt-1 text-sm text-gray-900 dark:text-white sm:col-span-2 sm:mt-0"},Qo={class:"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5"},Go={class:"mt-1 text-sm text-gray-900 dark:text-white sm:col-span-2 sm:mt-0"},Jo={key:1},Xo={key:2},Zo={key:3,class:"space-y-6"},na={__name:"UserDashboardView",setup(c){const B=ae(),I=q(),$=G(),g=T("overview"),u=T(null),s=T({active:0,deleted:0}),k=w=>{g.value=w,w==="overview"&&(console.log("[UserDashboard] 切换到概览页面，刷新数据"),M(!0),U())},b=async()=>{try{await I.logout(),D("Logged out successfully","success"),B.push("/user-login")}catch{D("Logout failed","error")}},M=async(w=!1)=>{var o,f,d,v;try{w&&console.log("[UserDashboard] 强制刷新用户资料和统计信息"),u.value=await I.getUserProfile(),console.log("[UserDashboard] 用户资料加载完成:",{userId:(o=u.value)==null?void 0:o.id,username:(f=u.value)==null?void 0:f.username,totalUsage:(d=u.value)==null?void 0:d.totalUsage,apiKeyCount:(v=u.value)==null?void 0:v.apiKeyCount})}catch(p){console.error("Failed to load user profile:",p),D("加载用户资料失败","error")}},U=async()=>{try{const w=await I.getUserApiKeys(!0);console.log("[UserDashboard] 收到所有 API Keys:",w);const o=w.filter(p=>!(p.isDeleted==="true"||p.deletedAt)&&p.isActive),f=w.filter(p=>p.isDeleted==="true"||p.deletedAt);console.log("[UserDashboard] 活跃的密钥:",o),console.log("[UserDashboard] 已删除的密钥:",f),console.log("[UserDashboard] 活跃数量:",o.length),console.log("[UserDashboard] 已删除数量:",f.length);const d=o.reduce((p,x)=>{var n;return p+(((n=x.usage)==null?void 0:n.requests)||0)},0),v=o.reduce((p,x)=>{var n;return p+(((n=x.usage)==null?void 0:n.totalCost)||0)},0);console.log("[UserDashboard] API Keys 统计汇总:",{totalRequests:d,totalCost:v,activeKeysCount:o.length}),s.value={active:o.length,deleted:f.length}}catch(w){console.error("Failed to load API keys stats:",w),s.value={active:0,deleted:0}}};return E(()=>{$.initTheme(),M(),U()}),(w,o)=>{var f,d,v,p,x,n,m,t,i,C,P,K;return l(),r("div",Qs,[e("nav",Gs,[e("div",Js,[e("div",Xs,[e("div",Zs,[o[4]||(o[4]=e("div",{class:"flex flex-shrink-0 items-center"},[e("svg",{class:"h-8 w-8 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})]),e("span",{class:"ml-2 text-xl font-bold text-gray-900 dark:text-white"},"Claude Relay")],-1)),e("div",eo,[e("div",to,[e("button",{class:z(["rounded-md px-3 py-2 text-sm font-medium",g.value==="overview"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:o[0]||(o[0]=V=>k("overview"))}," 概览 ",2),e("button",{class:z(["rounded-md px-3 py-2 text-sm font-medium",g.value==="api-keys"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:o[1]||(o[1]=V=>k("api-keys"))}," API 密钥 ",2),e("button",{class:z(["rounded-md px-3 py-2 text-sm font-medium",g.value==="usage"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:o[2]||(o[2]=V=>k("usage"))}," 使用统计 ",2),e("button",{class:z(["rounded-md px-3 py-2 text-sm font-medium",g.value==="tutorial"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]),onClick:o[3]||(o[3]=V=>k("tutorial"))}," 使用教程 ",2)])])]),e("div",so,[e("div",oo,[o[5]||(o[5]=j(" 欢迎，",-1)),e("span",ao,a(y(I).userName),1)]),F(re,{mode:"icon"}),e("button",{class:"rounded-md px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:b}," 退出登录 ")])])])]),e("main",ro,[g.value==="overview"?(l(),r("div",lo,[o[23]||(o[23]=e("div",null,[e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"仪表板概览"),e("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},"欢迎使用 Claude Relay 仪表板")],-1)),e("div",no,[e("div",io,[e("div",uo,[e("div",co,[o[7]||(o[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15 7a2 2 0 012 2m0 0a2 2 0 012 2m-2-2h-6m6 0v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2h6z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",xo,[e("dl",null,[o[6]||(o[6]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 活跃的 API 密钥 ",-1)),e("dd",mo,a(s.value.active),1)])])])])]),e("div",go,[e("div",yo,[e("div",vo,[o[9]||(o[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",po,[e("dl",null,[o[8]||(o[8]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 已删除的 API 密钥 ",-1)),e("dd",fo,a(s.value.deleted),1)])])])])]),e("div",ko,[e("div",ho,[e("div",bo,[o[11]||(o[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M13 10V3L4 14h7v7l9-11h-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",wo,[e("dl",null,[o[10]||(o[10]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总请求数 ",-1)),e("dd",_o,a(y(A)(((d=(f=u.value)==null?void 0:f.totalUsage)==null?void 0:d.requests)||0)),1)])])])])]),e("div",$o,[e("div",Co,[e("div",Ao,[o[13]||(o[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Mo,[e("dl",null,[o[12]||(o[12]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 输入 Token 数 ",-1)),e("dd",To,a(y(A)(((p=(v=u.value)==null?void 0:v.totalUsage)==null?void 0:p.inputTokens)||0)),1)])])])])]),e("div",Io,[e("div",Po,[e("div",Uo,[o[15]||(o[15]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Bo,[e("dl",null,[o[14]||(o[14]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总费用 ",-1)),e("dd",Do," $"+a((((n=(x=u.value)==null?void 0:x.totalUsage)==null?void 0:n.totalCost)||0).toFixed(4)),1)])])])])])]),e("div",So,[e("div",jo,[o[22]||(o[22]=e("h3",{class:"text-lg font-medium leading-6 text-gray-900 dark:text-white"},"账户信息",-1)),e("div",Ko,[e("dl",zo,[e("div",Fo,[o[16]||(o[16]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"用户名",-1)),e("dd",Vo,a((m=u.value)==null?void 0:m.username),1)]),e("div",Lo,[o[17]||(o[17]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"显示名称",-1)),e("dd",qo,a(((t=u.value)==null?void 0:t.displayName)||"无"),1)]),e("div",Ho,[o[18]||(o[18]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"邮箱",-1)),e("dd",Ro,a(((i=u.value)==null?void 0:i.email)||"无"),1)]),e("div",No,[o[19]||(o[19]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"角色",-1)),e("dd",Eo,[e("span",Oo,a(((C=u.value)==null?void 0:C.role)==="admin"?"管理员":"用户"),1)])]),e("div",Wo,[o[20]||(o[20]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"注册时间",-1)),e("dd",Yo,a(y(S)((P=u.value)==null?void 0:P.createdAt)),1)]),e("div",Qo,[o[21]||(o[21]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"最后登录",-1)),e("dd",Go,a(y(S)((K=u.value)==null?void 0:K.lastLoginAt)||"无"),1)])])])])])])):g.value==="api-keys"?(l(),r("div",Jo,[F(Nt)])):g.value==="usage"?(l(),r("div",Xo,[F(Ys)])):g.value==="tutorial"?(l(),r("div",Zo,[F(de)])):h("",!0)])])}}};export{na as default};
